<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Pricing Plans - Bootstrap Admin</title>

<meta name="viewport"
	content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<meta name="apple-mobile-web-app-capable" content="yes" />

<link href="./css/bootstrap.min.css" rel="stylesheet" />
<link href="./css/bootstrap-responsive.min.css" rel="stylesheet" />


<link href="./css/font-awesome.css" rel="stylesheet" />

<link href="./css/adminia.css" rel="stylesheet" />
<link href="./css/adminia-responsive.css" rel="stylesheet" />


<link href="./css/pages/plans.css" rel="stylesheet" />
<script type="text/javascript"
	src="https://cdn.hcharts.cn/jquery/jquery-1.8.3.min.js"></script>
<script src="https://cdn.hcharts.cn/highcharts/5.0.10/highcharts.js"></script>
<script
	src="https://cdn.hcharts.cn/highcharts/5.0.10/modules/exporting.js"></script>


<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
<!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
</head>

<script>
	function run(year)
	{
	    return (year%400==0||(year%100!=0&&year%4==0));
	}

	function fun( year, month,day)
	{
	    var ty=year;   //读来的年份
	    var m=month;   //读来的月份
	    if(m<3)
	    {
	        m=12+m;    //1,2月看作去年的13,14月份
	        ty--;
	    }
	    var y=ty%100;           //年份(2位数)
	    var c=ty/100;           //世纪(2位数)
	    var d=day;              //读来的日期
	    var weeks=(y+y/4+c/4-2*c+26*(m+1)/10+d-1)%7;  //得出星期几  (0 星期日,1星期一,6星期六)
	    if( weeks == 0 )weeks = 7;
	    return weeks;
	}


	function deal(year,week)
	{

	    var cnt = (week-1)*7;
	    var month = 1, day = 1;
	    
	    year = parseInt(year);
		week = parseInt(week);
		day = parseInt(day);
		
	    var initDay = fun(year,month,day) ; //获得该年一月一日是星期几
	    
	    initDay = parseInt(initDay);
	    
	    if(initDay == 0){
	    	initDay = 1;
	    }
	    
	    if( initDay != 1 ){
	        year--;
	        month = 12;
	        day = 32;
	    }
	    
	    while( initDay != 1 ){
	        day--;
	        initDay--;
	    }
	    day += cnt;
	    
	    var month_date = [31,28,31,30,31,30,31,31,30,31,30,31];
	    do{
	    	//var year_temp = parseInt(year);
	        if((year%400==0||(year%100!=0&&year%4==0))){
	            month_date[1] = 29;
	        }
	        else month_date[1] = 28;
	        

	        if(day>month_date[month-1]){
	        	day-=month_date[month-1];
	            month++;
	            if(month==13){
	                year++;
	                month=1;
	            }
	        }
	        
	    }while(day>month_date[month-1]);
	    
	    return (year+"-"+month+"-"+day);
	    
	   }

	
	</script>
<body>

	<div class="navbar navbar-fixed-top">

		<div class="navbar-inner">

			<div class="container">

				<a class="btn btn-navbar" data-toggle="collapse"
					data-target=".nav-collapse"> <span class="icon-bar"></span> <span
					class="icon-bar"></span> <span class="icon-bar"></span>
				</a> <a class="brand" href="./">GodEyes</a>

				<div class="nav-collapse">

					<ul class="nav pull-right">
						<li><a href="#"><span class="badge badge-warning">7</span></a>
						</li>

						<li class="divider-vertical"></li>

						<li class="dropdown"><a data-toggle="dropdown"
							class="dropdown-toggle " href="#"> Crazy11586 <b
								class="caret"></b>
						</a>

							<ul class="dropdown-menu">
								<li><a href="./account.html"><i class="icon-user"></i>
										None </a></li>

								<li><a href="./change_password.html"><i
										class="icon-lock"></i> None</a></li>

								<li class="divider"></li>

								<li><a href="./"><i class="icon-off"></i> None</a></li>
							</ul></li>
					</ul>

				</div>
				<!-- /nav-collapse -->

			</div>
			<!-- /container -->

		</div>
		<!-- /navbar-inner -->

	</div>
	<!-- /navbar -->




	<div id="content">

		<div class="container">

			<div class="row">

				<div class="span3">

					<div class="account-container">

						<div class="account-avatar">
							<img src="./img/headshot.png" alt="" class="thumbnail" />
						</div>
						<!-- /account-avatar -->

						<div class="account-details">

							<span class="account-name">Crazy11586</span> <span
								class="account-role">管理员</span> <span
								class="account-actions"> <a href="javascript:;">切换用户</a>
								| <a href="javascript:;">资料设置</a>
							</span>

						</div>
						<!-- /account-details -->

					</div>
					<!-- /account-container -->

					<hr />

					<ul id="main-nav" class="nav nav-tabs nav-stacked">

						<li><a href="./"> <i class="icon-home"></i>
								客流管理
						</a></li>
						
						<li  class="active"><a href="./plans2.html"> <i class="icon-pushpin"></i>
								新老顾客
						</a></li>
 
						<li><a href="./plans.html"> <i class="icon-th-list"></i>
								客流趋势
						</a></li>

						<li><a href="./grid.html"> <i class="icon-th-large"></i>
								设备管理 <!-- 
						<span class="label label-warning pull-right">5</span>
						-->
						</a></li>

						<!--  
						<li><a href="./charts.html"> <i class="icon-signal"></i>
								Charts
						</a></li>
						-->
						<li><a href="./account.html"> <i class="icon-user"></i>
								资料设置
						</a></li>

						<li><a href="./login.html"> <i class="icon-lock"></i>
								切换
						</a></li>

					</ul>

					<hr />

					<br />

				</div>
				<!-- /span3 -->



				<div class="span9">

					<h1 class="page-title">
						<i class="icon-th-list"></i> 客流趋势
					</h1>

					<script type="text/javascript">
		
		
		
		function getStore(){
			  var url_at = "http://localhost:8080/Test01/GetDataAction?action=getStore"; 
		      //清空原有select内的数据
		      $("#my_store_plans").empty();
		      
		      $.ajax({ 
		          url:url_at , 
		          type:"post" , 
		          dataType:"json",
		          success:function(data){   
		        	  
		              var count = 1;
		              
		              $.each(data, function (index, item) {
		            	  
		                  var id = count++; 
		                  var text = data[index].store_name; 
		                  
		                  $("#my_store_plans").append("<option value='"+id+"'>"+text+"</option>");       
		                 
		              }); 
		          }, 
		      error:function(XMLHttpRequest,textStatus, errorThrown) { 
		           alert(errorThrown);
		         }
		      });   
		}
		
		getStore();
		
		  
			
			
			
		
		</script>

					<div class="widget">

						<div class="widget-header">
							<i class="icon-signal"></i>
							<h3>店铺 :</h3>
							<select id="my_store_plans" class="cs-select cs-skin-rotate"
								style="margin: auto 0">

							</select>

						</div>

						<script type="text/javascript">
					 $(function(){
						 
						  $(":radio").click(function(){
						   		$("#week").toggle();
						   		$("#day").toggle();			   		
						   	
						  });
						 
					 });
					 
					
					</script>


						<div class="widget-content">

							<h4>日期筛选&nbsp;:</h4>

							<input id="day_radio" type="radio" name="pick_time" value="0"
								checked style="margin-left: 30px">按周筛选</input> <input
								id="week_radio" type="radio" name="pick_time" value="1"
								style="margin-left: 30px">按日筛选</input><br /> <input id="day"
								style="display: none; margin-left: 30px; margin-top: 8px"
								type="date" value="2017-05-01" min="2017-05-01" max="2017-06-29" />
							<input id="week" style="margin-left: 30px; margin-top: 8px"
								type="week" value="2017-W18" min="2017-W18" max="2017-W26" /> <input
								type="button" value="refresh"
								style="margin-left: 10px; margin-top: 8px" onclick="check()" />

							<hr />

							<div id="container"
								style="min-width: 310px; height: 436px; max-width: 870px; margin: 0 auto"></div>

						</div>
						<!-- /widget-content -->

						<script>
					var time = 1507248000000;
			        var chart;
					$(document).ready(function() {
						chart = Highcharts.chart('container', {
						chart: {
							type: 'spline'
						},
						title :{
							text:"客流趋势",
							style:{
								color:"#000000"
							}
						},
						series: [{
							name: "新顾客"
			
						},{
							name: "老顾客"
						}],
				        xAxis: {
				            type: 'datetime',
				            labels: {
				                overflow: 'justify'
				            },
							categories:[]
				        },
				        yAxis: {
				            title: {
				                text: ''
				            },
				            min: 0,
				            minorGridLineWidth: 0,
				            gridLineWidth: 0,
				            alternateGridColor: null
				
				        },
				        tooltip: {
				            valueSuffix: ' 人次'
				        },
				        plotOptions: {
				            spline: {
				                lineWidth: 2,
				                states: {
				                    hover: {
				                        lineWidth: 3
				                    }
				                },
				                marker: {
				                    enabled: false
				                },
								step:3
				            },
							series: {
				
							}
						}
					});
				});
					
					 
				
					
					function GetSumData(time1,time2){
						//客流量 + 新顾客数量 + 老顾客数量
						//获取当前天数的
						
					     

					      var str = 'http://localhost:8080/Test01/GetDataAction?action=getCustomerCount2time&time1='+time1+'&time2='+time2;
					      $.ajax({ 
					    	  //http://localhost:1314/Test01/GetDataAction?action=getall&time1=1496804400000&time2=1496807999000
					    	  url: str, 
					          type:"post" , 
					          dataType:"json",
					          success:function(data1	){
					            //  $("#my_store").append("<option value='-1'>--请选择需要展示的店铺--</option>");	           
					              var count = 1;
					            //  alert(data);
					              var keliu;
					              var xinguke = 0;
					              var laoguke = 0;
					            var data = [];
								var data2 = [];
								var cate = [];
								
					              $.each(data1, function (index, item) {
					                  var id = count++; 
					                  var all = data1[index].all;	                
					                  var time = parseInt(data1[index].current_time);	                  
				                  	  var enter = data1[index].enter;
									 
				                  	 data.push([data1[index].current_time,parseFloat(all)]);
			                         data2.push([data1[index].current_time,parseFloat(enter)]);
			                         cate.push(time);	              
			         
					              });
					              
					              chart.xAxis[0].categories = [];
									for(var j=0;j<cate.length;j++){
									    if(cate[j] == ".."){
									    	
									        chart.xAxis[0].categories.push(" ");
									        
									    }else{
									    	
									   		chart.xAxis[0].categories.push(ge_time_format2hour(parseInt(cate[j])));
									    	
									    }
									    	
										
									}
									
									console.log(data);
									chart.series[0].setData(data);
									chart.series[1].setData(data2);
				                    chart.setTitle("asdads");
					              
					              
					          }, 
					      	  error:function(XMLHttpRequest,textStatus, errorThrown) { 
					    	  
					           alert(errorThrown);
					         
					      	  }
					      }); 
					}
				function ge_time_format2all(timestamp){
					if(timestamp){
						var date = new Date(timestamp);
					}else{
						var date = new Date();
					}
					Y = date.getFullYear(),
					m = date.getMonth()+1,
					d = date.getDate();
					var h = date.getHours(); 
					var M = date.getMinutes(); 
					var s = date.getSeconds();
					if(m<10){
							m = '0'+m;
					}
					if(d<10){
						d = '0'+d;
					}
					if(h<10){
						h = '0'+h;
					}
					if(M<10){
						M = '0'+M;
					}
					if(s<10){
						s = '0'+s;
					}
			
						var t = Y+'-'+m+'-'+d+' '+h+':'+M+':'+s;
						return t;
					}
					 
				function ge_time_format(timestamp){
					if(timestamp){
						var date = new Date(timestamp);
					}else{
						var date = new Date();
					}
					Y = date.getFullYear(),
					m = date.getMonth()+1,
					d = date.getDate();
					if(m<10){
						m = '0'+m;
					}
					if(d<10){
						d = '0'+d;
					}
		
					var t = Y+'-'+m+'-'+d;
					return t;
				}
				
				function ge_time_format2hour(timestamp){
					if(timestamp){
						var date = new Date(timestamp);
					}else{
						var date = new Date();
					}
					
					var h = date.getHours(); 
					var m = date.getMinutes(); 
					var s = date.getSeconds();
					
					if(h<10){
						h = '0'+h;
					}
					if(m<10){
						m = '0'+m;
					}
		
					var t = h+':'+m;
					return t;
				}

				function f1( time1 , time2 ){
					getCustomer(time1,time2);
					GetSumData(time1,time2);
				    
				}
				f1( '1496804341336' , '1496805355381' );
					
				function check(){
						 if($('input:radio[id="day_radio"]:checked').val() == null){
							 var str = $("#day").val();
							 str+=" 00:00:00"
							 var timestamp2 = Date.parse(new Date(str));
							// console.log(timestamp2+""+(timestamp2+1000*60*60*24-1));
							 f1(timestamp2,(timestamp2+1000*60*60*24-1));
							
						 }else{
							 var str = $("#week").val();
							 var str_year = str.substring(0,4);
							 var str_week = str.substring(6,str.length);
							 
							 var timestamp = deal(str_year,str_week);
							 var timestamp2 = Date.parse(new Date(timestamp));
							f1(timestamp2,(timestamp2+1000*60*60*24*6));
							 
						 }
					 }
					
			function getCustomer(time1,time2){
						//  var url_at = "http://localhost:1314/Test01/GetDataAction?action=getCustomerCount2time&time1="+time1+"&time2="+time2; 
					      //清空原有select内的数据
					      $("#customerbody").empty();
					      
					    //  time1 = "1496804400000";
					    //  time2 = "1496807999000";
					      
					      var str = 'http://localhost:8080/Test01/GetDataAction?action=getCustomerCount2time&time1='+time1+'&time2='+time2;
					      $.ajax({ 
					    	  //http://localhost:1314/Test01/GetDataAction?action=getall&time1=1496804400000&time2=1496807999000
					    	  url: str, 
					          type:"post" , 
					          dataType:"json",
					          success:function(data){
					            //  $("#my_store").append("<option value='-1'>--请选择需要展示的店铺--</option>");	           
					              var count = 1;
					            //  alert(data);
					              $.each(data, function (index, item) {
					            	//  alert("yes");
					                  var id = count++; 
					                  var all = data[index].all;
					                
					                  var time = parseInt(data[index].current_time);
					                  
					                  var enter = data[index].enter;

					                  var number  ="<td style=\"width:40px;text-align:center\">"+id+"</td>";
					                  var time = "<td style=\"text-align:center\">"+ge_time_format2all(time)+"</td>";
					                  var AllCustomer = "<td style=\"text-align:center\">"+enter+"</td>";
					                  var enterCustomer = "<td style=\"text-align:center\">"+all+"</td>";
					                //  var rate_temp =(enter/all*100)+""	; 
					               //   var rate = "<td style=\"text-align:center\">"+rate_temp.substring(0,5)+"% </td>";
					                  var cl = "<td class=\"action-td\" style=\"text-align:center\"><a href=\"javascript:;\" class=\"btn btn-small btn-warning\"> <i class=\"icon-ok\"></i> </a> <a href=\"javascript:;\" class=\"btn btn-small\"> <i class=\"icon-remove\"></i></a></td>";
					                  
					                  var html = "<tr>"+number+""+time+""+
					                  AllCustomer+""+enterCustomer+""
					                  //+rate+""
					                  +cl+"</tr>";
					                  
					                  $("#customerbody").append(html);
			           
					              }); 
					          }, 
					      error:function(XMLHttpRequest,textStatus, errorThrown) { 
					           alert(errorThrown);
					         }
					      });   
					}
				</script>

					</div>
					<!-- /widget -->



					<div class="widget widget-table">

						<div class="widget-header">
							<h3>数据详情</h3>
						</div>
						<!-- /widget-header -->

						<div class="widget-content">
							<table class="table table-striped table-bordered">
								<thead>
									<tr>
										<th style="width: 40px; text-align: center">#</th>
										<th style="text-align: center">扫描时间</th>
										<th style="text-align: center">新顾客</th>
										<th style="text-align: center">老顾客</th>
										<!--  <th style="text-align: center">入店率</th>-->
										<th>&nbsp;</th>
									</tr>
								</thead>

								<tbody id="customerbody">


								</tbody>
							</table>
						</div>
						<!-- /widget-content -->

					</div>
					<!-- /widget -->



				</div>
				<!-- /span9 -->


			</div>
			<!-- /row -->

		</div>
		<!-- /container -->

	</div>
	<!-- /content -->


	<div id="footer">



	</div>
	<!-- /footer -->

	<script src="./js/bootstrap.js"></script>

</body>
</html>
